## Lab Description: Exploiting XXE to perform SSRF attacks

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/b75e9ccc-3cf8-49c6-92af-13370adf875c)


## Solution: 

Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.
Send the request to repeater.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/12e3ab83-47a8-4895-862a-a05e94f2fd7f)

Replace the productId number with a reference to the external entity:

Insert the following external entity definition in between the XML declaration and the stockCheck element:
```
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>
```

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/47aa50e7-792b-4ac1-ac3d-49d8997d649a)

The response should contain "Invalid product ID:" followed by the response from the metadata endpoint, which will initially be a folder name.

update /latest

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/42f058f7-05b1-4a82-8e1b-0f83d0ce5c2d)

We are getting /metadata which we have to add again

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/0ec93275-8dd9-4588-9081-4cbefb8e1049)

Now update /iam

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/043a930e-11e6-4c62-8f2d-27f75b64e0f1)

Iteratively update the URL in the DTD to explore the API until you reach /latest/meta-data/iam/security-credentials/admin. This should return JSON containing the SecretAccessKey.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/dc69be2a-c0f7-4035-bee3-cb5cbd4969f8)

Lab Solved

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/88caea3d-b459-4c36-a640-9cffb283f500)

**
