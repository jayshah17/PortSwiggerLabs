## Lab Description: Exploiting XXE using external entities to retrieve files



## Solution:

To perform an XXE injection attack that retrieves an arbitrary file from the server's filesystem, you need to modify the submitted XML in two ways:

Introduce (or edit) a DOCTYPE element that defines an external entity containing the path to the file.
Edit a data value in the XML that is returned in the application's response, to make use of the defined external entity.
For example, suppose a shopping application checks for the stock level of a product by submitting the following XML to the server:
```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```
The application performs no particular defenses against XXE attacks, so you can exploit the XXE vulnerability to retrieve the /etc/passwd file by submitting the following XXE payload:
```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```

Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/10b8d1a3-cebf-43c7-9ec0-a01ed0a3f18f)

Insert the following external entity definition in between the XML declaration and the stockCheck element:
```
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
```

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/4301fcb7-3f5c-418c-b964-d12794c46604)

Replace &xxe;

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/992f8d24-567b-4369-922b-03c6629d5f19)

The response should contain "Invalid product ID:" followed by the contents of the /etc/passwd file.

Lab Solved

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/b716a0d8-f795-4584-a29d-09ec614aa76e)

